import{u as x,i as ee,a as te,b as se,_ as le}from"./EChart.vue_vue_type_script_setup_true_lang-e0bf0237.js";import{d as A,c as M,o as m,i as R,n as u,K as ne,x as I,a as f,l as g,k as v,s as oe,b as c,t as E,p as ae,_ as S,L as Z,M as j,e as K,N as ue,O as H,P as J,y as re,f as X,B as z,G as O,F as w,r as P,w as q}from"./index-1bee1cb1.js";import{t as ce}from"./budgets-531db56b.js";import{P as de}from"./Pane-ff954356.js";import{B as U}from"./Button-6d17a4fd.js";import{C as F}from"./Currency-e1b802bf.js";import{u as pe}from"./useMonthNames-09c7e203.js";const ie=A({__name:"MiniChart",props:{class:{},values:{}},setup(b){const _=b;x([ee,te,se]);const l=M(()=>_.class),d=M(()=>({xAxis:{type:"category",show:!1},yAxis:{show:!1,min:Math.min(..._.values)},grid:{top:"15%",left:0,bottom:"20%",right:0},series:[{data:_.values,type:"line",smooth:!0,showSymbol:!1,silent:!0}]}));return(p,i)=>(m(),R(le,{class:u(l.value),options:d.value},null,8,["class","options"]))}}),o=ne({group:void 0,source:void 0,target:void 0,type:void 0}),me=A({__name:"Draggable",props:{text:{type:Function},name:{},id:{}},emits:["drop"],setup(b,{emit:_}){const l=b,d=I(),p=I(),i=I(0),h=I(0),B=M(()=>l.id===o.target&&o.type),N=M(()=>B.value?o.type==="before"?"skip-up-line":"skip-down-line":"draggable"),k=M(()=>{var s;return o.target&&o.target&&o.source?(s=l.text)==null?void 0:s.call(l,o):void 0}),G=s=>{s.dataTransfer&&p.value&&(o.group=l.name,o.source=l.id,s.dataTransfer.effectAllowed="move",s.dataTransfer.setDragImage(p.value,1/0,1/0),s.dataTransfer.setData("text/plain",l.name))},C=s=>{i.value=s.pageX,h.value=s.pageY},a=s=>{var e;if(o.group===l.name){const y=(e=d.value)==null?void 0:e.getBoundingClientRect();if(s.preventDefault(),y&&l.id!==o.source){const n=s.pageY<y.top+y.height/2?"before":"after";o.target=l.id,o.type=n}}},t=s=>{s.pageX&&s.pageY&&o.target!==l.id&&(o.type=void 0,o.target=void 0)},$=()=>{o.type=void 0,o.target=void 0,o.source=void 0,o.group=void 0},r=s=>{o.target&&o.target&&o.source&&_("drop",o),s.preventDefault()};return(s,e)=>(m(),f("div",{ref_key:"draggable",ref:d,class:u(s.$style.draggable),draggable:"true",onDragend:$,onDragover:a,onDragleave:t,onDrop:r,onDrag:C,onDragstart:G},[g(U,{color:v(o).group===l.name?"primary":"dimmed",icon:N.value,textual:""},null,8,["color","icon"]),v(o).source===l.id&&h.value&&i.value&&k.value?(m(),f("div",{key:0,style:oe({top:`${h.value+5}px`,left:`${i.value+5}px`}),class:u(s.$style.content)},[c("span",{class:u(s.$style.text)},E(k.value),3)],6)):ae("",!0),c("div",{ref_key:"element",ref:p,class:u(s.$style.hidden)},"hidden",2)],34))}}),ge="lb",ve="mb",ye="nb",fe="ob",$e={draggable:ge,content:ve,text:ye,hidden:fe},be={$style:$e},Q=S(me,[["__cssModules",be]]),_e=["type","value"],he=A({__name:"CurrencyCell",props:Z({max:{default:Number.MAX_SAFE_INTEGER}},{modelValue:{}}),emits:["update:modelValue"],setup(b){const _=b,l=j(b,"modelValue"),d=I(),p=I(!1),{n:i}=K(),h=M(()=>p.value||!l.value?l.value||"":i(l.value,"currency")),B=a=>{const t=Number((a==null?void 0:a.trim())||NaN);l.value=Number.isNaN(t)?0:t},N=a=>{a.key==="-"&&a.preventDefault()},k=()=>{p.value=!0,J(()=>d.value.select())},G=a=>B(a.target.value),C=a=>{var t;return B((t=a.clipboardData)==null?void 0:t.getData("text/plain").trim())};return ue(()=>l.value,(a,t)=>{(a??0)>_.max&&t!==void 0&&(l.value=t)}),(a,t)=>(m(),f("input",{ref_key:"input",ref:d,class:u(a.$style.currencyCell),type:p.value?"number":"text",value:h.value,onBlur:t[0]||(t[0]=$=>p.value=!1),onFocus:k,onInput:G,onKeydown:[N,t[1]||(t[1]=H((...$)=>{var r,s;return((r=d.value)==null?void 0:r.blur)&&((s=d.value)==null?void 0:s.blur(...$))},["enter"]))],onPaste:C},null,42,_e))}}),Be="pb",Ce={currencyCell:Be},Me={$style:Ce},ke=S(he,[["__cssModules",Me]]),De=["value"],Ge=A({__name:"TextCell",props:Z({inline:{type:Boolean,default:!1}},{modelValue:{}}),emits:["update:modelValue"],setup(b){const _=b,l=j(b,"modelValue"),d=I(),p=re(),i=I(!1),h=M(()=>[p.textInput,{[p.empty]:!l.value,[p.inline]:_.inline}]),B=()=>{i.value=!0,J(()=>{d.value.select()})},N=k=>{l.value=k.target.value};return(k,G)=>(m(),f("span",{class:u(h.value)},[c("input",{ref_key:"input",ref:d,value:l.value,class:u(k.$style.input),type:"text",onBlur:G[0]||(G[0]=C=>i.value=!1),onFocus:B,onInput:N,onKeydown:G[1]||(G[1]=H((...C)=>{var a,t;return((a=d.value)==null?void 0:a.blur)&&((t=d.value)==null?void 0:t.blur(...C))},["enter"]))},null,42,De)],2))}}),Ve="vb",Ne="wb",we="xb",Ie="yb",Te={textInput:Ve,input:Ne,inline:we,empty:Ie},Ae={$style:Te},W=S(Ge,[["__cssModules",Ae]]),Fe=c("span",null,null,-1),Pe=c("span",{style:{"grid-column":"3 / 16"}},null,-1),Se=A({__name:"BudgetGroup",props:{group:{}},setup(b){const _=b,{moveBudget:l,removeBudgetGroup:d,getBudget:p,addBudget:i,setBudgetName:h,setBudgetGroupName:B,setBudget:N,removeBudget:k,isCurrentMonth:G}=X(),{t:C}=K(),a=M(()=>{const e=new Array(12).fill(0);for(const{values:y}of _.group.budgets)for(let n=0;n<y.length;n++)e[n]+=y[n];return e}),t=M(()=>z(a.value)),$=M(()=>O(a.value)),r=e=>{const[y,n]=e.source?p(e.source)??[]:[],[D,T]=e.target?p(e.target)??[]:[];if(n&&y){if(T&&D){const V=y.id===D.id,L=V?n.name:`${y.name} » ${n.name}`,Y=V?T.name:`${D.name} » ${T.name}`;return e.type==="before"?C("budget.prepend",{from:L,to:Y}):C("budget.append",{from:L,to:Y})}return C("budget.move",{from:n.name})}},s=e=>{l(e.source,e.target,e.type==="after")};return(e,y)=>(m(),f(w,null,[g(U,{color:"dimmed",icon:"close-circle",textual:"",onClick:y[0]||(y[0]=n=>v(d)(e.group.id))}),g(W,{class:u([e.$style.top,e.$style.start]),"model-value":e.group.name,inline:"","onUpdate:modelValue":y[1]||(y[1]=n=>v(B)(e.group.id,n))},null,8,["class","model-value"]),(m(!0),f(w,null,P(a.value,(n,D)=>(m(),f("span",{key:D,class:u(e.$style.top)},[g(F,{value:n},null,8,["value"])],2))),128)),c("span",{class:u(e.$style.top)},[c("span",null,E(v(C)("budget.total")),1)],2),c("span",{class:u([e.$style.top,e.$style.end])},[c("span",null,E(v(C)("budget.average")),1)],2),(m(!0),f(w,null,P(e.group.budgets,(n,D)=>(m(),f(w,{key:n.id+D},[g(Q,{id:n.id,name:"budget-group",text:r,onDrop:s},null,8,["id"]),g(U,{color:"dimmed",icon:"close-circle",textual:"",onClick:T=>v(k)(n.id)},null,8,["onClick"]),c("span",{class:u(e.$style.header)},[g(W,{"model-value":n.name,"onUpdate:modelValue":T=>v(h)(n.id,T)},null,8,["model-value","onUpdate:modelValue"])],2),(m(!0),f(w,null,P(n.values,(T,V)=>(m(),f("span",{key:n.id+V,class:u([e.$style.currencyCell,{[e.$style.even]:D%2,[e.$style.firstRow]:D===0,[e.$style.firstColumn]:V===0,[e.$style.currentMonth]:v(G)(V),[e.$style.tlc]:D===0&&V===0,[e.$style.trc]:D===0&&V===11,[e.$style.blc]:D===e.group.budgets.length-1&&V===0,[e.$style.brc]:D===e.group.budgets.length-1&&V===11}])},[g(ke,{"model-value":n.values[V],"onUpdate:modelValue":L=>v(N)(n.id,V,L)},null,8,["model-value","onUpdate:modelValue"])],2))),128)),g(F,{class:u(e.$style.meta),value:v(z)(n.values)},null,8,["class","value"]),g(F,{class:u(e.$style.meta),value:v(O)(n.values)},null,8,["class","value"])],64))),128)),Fe,g(U,{icon:"plus",class:u(e.$style.addBudgetBtn),textual:"",color:"success",onClick:y[2]||(y[2]=n=>v(i)(e.group.id))},null,8,["class"]),Pe,g(F,{class:u([e.$style.meta,e.$style.bold]),value:t.value},null,8,["class","value"]),g(F,{class:u([e.$style.meta,e.$style.bold]),value:$.value},null,8,["class","value"])],64))}}),Ue="U_",Ee="V_",Le="W_",Re="X_",Ke="Y_",Xe="Z_",Ye="_b",ze="ab",Oe="bb",qe="cb",We="db",Ze="eb",je="fb",He="gb",Je="hb",Qe={header:Ue,meta:Ee,bold:Le,top:Re,start:Ke,end:Xe,currencyCell:Ye,firstRow:ze,firstColumn:Oe,currentMonth:qe,even:We,tlc:Ze,trc:je,blc:He,brc:Je},xe={$style:Qe},et=S(Se,[["__cssModules",xe]]),tt=c("span",null,null,-1),st=c("span",null,null,-1),lt=c("span",null,null,-1),nt=c("span",null,null,-1),ot=c("span",null,null,-1),at=c("span",null,null,-1),ut=c("span",null,null,-1),rt=c("span",null,null,-1),ct=c("span",null,null,-1),dt=c("span",null,null,-1),pt=A({__name:"BudgetGroups",props:{type:{}},setup(b){const _=b,{state:l,moveBudgetGroup:d,addBudgetGroup:p,getBudgetGroup:i,isCurrentMonth:h}=X(),{t:B}=K(),N=M(()=>l[_.type]),k=pe(),G=M(()=>{const t=new Array(12).fill(0);for(const{budgets:$}of N.value)for(const{values:r}of $)for(let s=0;s<r.length;s++)t[s]+=r[s];return t}),C=t=>{const $=t.source?i(t.source):void 0,r=t.target?i(t.target):void 0;if($)return r?t.type==="before"?B("budget.prepend",{from:$.name,to:r.name}):B("budget.append",{from:$.name,to:r.name}):B("budget.move",{from:$.name})},a=t=>{d(t.source,t.target,t.type==="after")};return(t,$)=>(m(),f("div",{class:u(t.$style.budgetGroups)},[tt,st,lt,(m(!0),f(w,null,P(v(k),(r,s)=>(m(),f("span",{key:r,class:u([t.$style.month,{[t.$style.current]:v(h)(s)}])},[c("span",null,E(r),1)],2))),128)),nt,ot,at,ut,c("span",{class:u(t.$style.sum)},E(v(B)("budget.totals")),3),(m(!0),f(w,null,P(G.value,(r,s)=>(m(),R(F,{key:s,value:r,class:u(t.$style.sum)},null,8,["value","class"]))),128)),rt,ct,(m(!0),f(w,null,P(N.value,r=>(m(),f(w,{key:r.id},[g(Q,{id:r.id,text:C,name:"budget-groups",onDrop:a},null,8,["id"]),g(et,{group:r},null,8,["group"])],64))),128)),dt,g(U,{class:u(t.$style.addGroupBtn),icon:"plus",text:v(B)("budget.addGroup"),onClick:$[0]||($[0]=r=>v(p)(t.type))},null,8,["class","text"])],2))}}),it="n_",mt="o_",gt="p_",vt="q_",yt="r_",ft={budgetGroups:it,sum:mt,month:gt,current:vt,addGroupBtn:yt},$t={$style:ft},bt=S(pt,[["__cssModules",$t]]),_t=A({__name:"BudgetPane",props:{title:{},type:{}},setup(b){const _=b,{state:l}=X(),d=M(()=>ce(l[_.type])),p=M(()=>d.value.reduce((i,h)=>i+h,0));return(i,h)=>(m(),R(de,{amount:p.value,title:i.title},{header:q(()=>[g(ie,{class:u(i.$style.miniChart),values:d.value},null,8,["class","values"])]),default:q(()=>[g(bt,{type:i.type},null,8,["type"])]),_:1},8,["amount","title"]))}}),ht="n",Bt={miniChart:ht},Ct={$style:Bt},It=S(_t,[["__cssModules",Ct]]);export{It as B};
