import{u as x,i as ee,a as te,b as se,_ as le}from"./EChart.vue_vue_type_script_setup_true_lang-3cc79900.js";import{d as T,c as M,o as m,i as R,n as u,K as ne,x as I,a as f,l as g,k as v,s as oe,b as c,t as S,p as ae,_ as L,L as H,M as j,e as U,N as ue,O as Q,P as W,y as re,f as z,B as Y,G as J,F as w,r as K,w as O}from"./index-dde7ce82.js";import{t as ce}from"./budgets-531db56b.js";import{P as de}from"./Pane-0cd97aa3.js";import{B as P}from"./Button-22082721.js";import{C as F}from"./Currency-ecccbfaf.js";import{u as pe}from"./useMonthNames-f094b651.js";const ie=T({__name:"MiniChart",props:{class:{},values:{}},setup(b){const h=b;x([ee,te,se]);const l=M(()=>h.class),d=M(()=>({xAxis:{type:"category",show:!1},yAxis:{show:!1,min:Math.min(...h.values)},grid:{top:"15%",left:0,bottom:"20%",right:0},series:[{data:h.values,type:"line",smooth:!0,showSymbol:!1,silent:!0}]}));return(p,i)=>(m(),R(le,{class:u(l.value),options:d.value},null,8,["class","options"]))}}),o=ne({group:void 0,source:void 0,target:void 0,type:void 0}),me=T({__name:"Draggable",props:{text:{type:Function},name:{},id:{}},emits:["drop"],setup(b,{emit:h}){const l=b,d=I(),p=I(),i=I(0),_=I(0),B=M(()=>l.id===o.target&&o.type),N=M(()=>B.value?o.type==="before"?"skip-up-line":"skip-down-line":"draggable"),k=M(()=>{var s;return o.target&&o.target&&o.source?(s=l.text)==null?void 0:s.call(l,o):void 0}),G=s=>{s.dataTransfer&&p.value&&(o.group=l.name,o.source=l.id,s.dataTransfer.effectAllowed="move",s.dataTransfer.setDragImage(p.value,1/0,1/0),s.dataTransfer.setData("text/plain",l.name))},C=s=>{i.value=s.pageX,_.value=s.pageY},a=s=>{var e;if(o.group===l.name){const y=(e=d.value)==null?void 0:e.getBoundingClientRect();if(s.preventDefault(),y&&l.id!==o.source){const n=s.pageY<y.top+y.height/2?"before":"after";o.target=l.id,o.type=n}}},t=s=>{s.pageX&&s.pageY&&o.target!==l.id&&(o.type=void 0,o.target=void 0)},$=()=>{o.type=void 0,o.target=void 0,o.source=void 0,o.group=void 0},r=s=>{o.target&&o.target&&o.source&&h("drop",o),s.preventDefault()};return(s,e)=>(m(),f("div",{ref_key:"draggable",ref:d,class:u(s.$style.draggable),draggable:"true",onDragend:$,onDragover:a,onDragleave:t,onDrop:r,onDrag:C,onDragstart:G},[g(P,{color:v(o).group===l.name?"primary":"dimmed",icon:N.value,textual:""},null,8,["color","icon"]),v(o).source===l.id&&_.value&&i.value&&k.value?(m(),f("div",{key:0,style:oe({top:`${_.value+5}px`,left:`${i.value+5}px`}),class:u(s.$style.content)},[c("span",{class:u(s.$style.text)},S(k.value),3)],6)):ae("",!0),c("div",{ref_key:"element",ref:p,class:u(s.$style.hidden)},"hidden",2)],34))}}),ge="db",ve="eb",ye="fb",fe="gb",$e={draggable:ge,content:ve,text:ye,hidden:fe},be={$style:$e},Z=L(me,[["__cssModules",be]]),he=["type","value"],_e=T({__name:"CurrencyCell",props:H({max:{default:Number.MAX_SAFE_INTEGER}},{modelValue:{}}),emits:["update:modelValue"],setup(b){const h=b,l=j(b,"modelValue"),d=I(),p=I(!1),{n:i}=U(),_=M(()=>p.value||!l.value?l.value||"":i(l.value,"currency")),B=a=>{const t=Number((a==null?void 0:a.trim())||NaN);l.value=Number.isNaN(t)?0:t},N=a=>{a.key==="-"&&a.preventDefault()},k=()=>{p.value=!0,W(()=>d.value.select())},G=a=>B(a.target.value),C=a=>{var t;return B((t=a.clipboardData)==null?void 0:t.getData("text/plain").trim())};return ue(()=>l.value,(a,t)=>{(a??0)>h.max&&t!==void 0&&(l.value=t)}),(a,t)=>(m(),f("input",{ref_key:"input",ref:d,class:u(a.$style.currencyCell),type:p.value?"number":"text",value:_.value,onBlur:t[0]||(t[0]=$=>p.value=!1),onFocus:k,onInput:G,onKeydown:[N,t[1]||(t[1]=Q((...$)=>{var r,s;return((r=d.value)==null?void 0:r.blur)&&((s=d.value)==null?void 0:s.blur(...$))},["enter"]))],onPaste:C},null,42,he))}}),Be="Gb",Ce={currencyCell:Be},Me={$style:Ce},ke=L(_e,[["__cssModules",Me]]),De=["value"],Ge=T({__name:"TextCell",props:H({inline:{type:Boolean,default:!1}},{modelValue:{}}),emits:["update:modelValue"],setup(b){const h=b,l=j(b,"modelValue"),d=I(),p=re(),i=I(!1),_=M(()=>[p.textInput,{[p.empty]:!l.value,[p.inline]:h.inline}]),B=()=>{i.value=!0,W(()=>{d.value.select()})},N=k=>{l.value=k.target.value};return(k,G)=>(m(),f("span",{class:u(_.value)},[c("input",{ref_key:"input",ref:d,value:l.value,class:u(k.$style.input),type:"text",onBlur:G[0]||(G[0]=C=>i.value=!1),onFocus:B,onInput:N,onKeydown:G[1]||(G[1]=Q((...C)=>{var a,t;return((a=d.value)==null?void 0:a.blur)&&((t=d.value)==null?void 0:t.blur(...C))},["enter"]))},null,42,De)],2))}}),Ve="Hb",Ne="Ib",we="Jb",Ie="Kb",Ae={textInput:Ve,input:Ne,inline:we,empty:Ie},Te={$style:Ae},q=L(Ge,[["__cssModules",Te]]),Fe=c("span",null,null,-1),Ke=c("span",{style:{"grid-column":"3 / 16"}},null,-1),Le=T({__name:"BudgetGroup",props:{group:{}},setup(b){const h=b,{moveBudget:l,removeBudgetGroup:d,getBudget:p,addBudget:i,setBudgetName:_,setBudgetGroupName:B,setBudget:N,removeBudget:k,isCurrentMonth:G}=z(),{t:C}=U(),a=M(()=>{const e=new Array(12).fill(0);for(const{values:y}of h.group.budgets)for(let n=0;n<y.length;n++)e[n]+=y[n];return e}),t=M(()=>Y(a.value)),$=M(()=>J(a.value)),r=e=>{const[y,n]=e.source?p(e.source)??[]:[],[D,A]=e.target?p(e.target)??[]:[];if(n&&y){if(A&&D){const V=y.id===D.id,E=V?n.name:`${y.name} » ${n.name}`,X=V?A.name:`${D.name} » ${A.name}`;return e.type==="before"?C("budget.prepend",{from:E,to:X}):C("budget.append",{from:E,to:X})}return C("budget.move",{from:n.name})}},s=e=>{l(e.source,e.target,e.type==="after")};return(e,y)=>(m(),f(w,null,[g(P,{color:"dimmed",icon:"close-circle",textual:"",onClick:y[0]||(y[0]=n=>v(d)(e.group.id))}),g(q,{class:u([e.$style.top,e.$style.start]),"model-value":e.group.name,inline:"","onUpdate:modelValue":y[1]||(y[1]=n=>v(B)(e.group.id,n))},null,8,["class","model-value"]),(m(!0),f(w,null,K(a.value,(n,D)=>(m(),f("span",{key:D,class:u(e.$style.top)},[g(F,{value:n},null,8,["value"])],2))),128)),c("span",{class:u(e.$style.top)},[c("span",null,S(v(C)("budget.total")),1)],2),c("span",{class:u([e.$style.top,e.$style.end])},[c("span",null,S(v(C)("budget.average")),1)],2),(m(!0),f(w,null,K(e.group.budgets,(n,D)=>(m(),f(w,{key:n.id+D},[g(Z,{id:n.id,name:"budget-group",text:r,onDrop:s},null,8,["id"]),g(P,{color:"dimmed",icon:"close-circle",textual:"",onClick:A=>v(k)(n.id)},null,8,["onClick"]),c("span",{class:u(e.$style.header)},[g(q,{"model-value":n.name,"onUpdate:modelValue":A=>v(_)(n.id,A)},null,8,["model-value","onUpdate:modelValue"])],2),(m(!0),f(w,null,K(n.values,(A,V)=>(m(),f("span",{key:n.id+V,class:u([e.$style.currencyCell,{[e.$style.even]:D%2,[e.$style.firstRow]:D===0,[e.$style.firstColumn]:V===0,[e.$style.currentMonth]:v(G)(V),[e.$style.tlc]:D===0&&V===0,[e.$style.trc]:D===0&&V===11,[e.$style.blc]:D===e.group.budgets.length-1&&V===0,[e.$style.brc]:D===e.group.budgets.length-1&&V===11}])},[g(ke,{"model-value":n.values[V],"onUpdate:modelValue":E=>v(N)(n.id,V,E)},null,8,["model-value","onUpdate:modelValue"])],2))),128)),g(F,{class:u(e.$style.meta),value:v(Y)(n.values)},null,8,["class","value"]),g(F,{class:u(e.$style.meta),value:v(J)(n.values)},null,8,["class","value"])],64))),128)),Fe,g(P,{icon:"plus",class:u(e.$style.addBudgetBtn),textual:"",color:"success",onClick:y[2]||(y[2]=n=>v(i)(e.group.id))},null,8,["class"]),Ke,g(F,{class:u([e.$style.meta,e.$style.bold]),value:t.value},null,8,["class","value"]),g(F,{class:u([e.$style.meta,e.$style.bold]),value:$.value},null,8,["class","value"])],64))}}),Pe="pb",Se="qb",Ee="rb",Re="sb",Ue="tb",ze="ub",Xe="vb",Ye="wb",Je="xb",Oe="yb",qe="zb",He="Ab",je="Bb",Qe="Cb",We="Db",Ze={header:Pe,meta:Se,bold:Ee,top:Re,start:Ue,end:ze,currencyCell:Xe,firstRow:Ye,firstColumn:Je,currentMonth:Oe,even:qe,tlc:He,trc:je,blc:Qe,brc:We},xe={$style:Ze},et=L(Le,[["__cssModules",xe]]),tt=c("span",null,null,-1),st=c("span",null,null,-1),lt=c("span",null,null,-1),nt=c("span",null,null,-1),ot=c("span",null,null,-1),at=c("span",null,null,-1),ut=c("span",null,null,-1),rt=c("span",null,null,-1),ct=c("span",null,null,-1),dt=c("span",null,null,-1),pt=T({__name:"BudgetGroups",props:{type:{}},setup(b){const h=b,{state:l,moveBudgetGroup:d,addBudgetGroup:p,getBudgetGroup:i,isCurrentMonth:_}=z(),{t:B}=U(),N=M(()=>l[h.type]),k=pe(),G=M(()=>{const t=new Array(12).fill(0);for(const{budgets:$}of N.value)for(const{values:r}of $)for(let s=0;s<r.length;s++)t[s]+=r[s];return t}),C=t=>{const $=t.source?i(t.source):void 0,r=t.target?i(t.target):void 0;if($)return r?t.type==="before"?B("budget.prepend",{from:$.name,to:r.name}):B("budget.append",{from:$.name,to:r.name}):B("budget.move",{from:$.name})},a=t=>{d(t.source,t.target,t.type==="after")};return(t,$)=>(m(),f("div",{class:u(t.$style.budgetGroups)},[tt,st,lt,(m(!0),f(w,null,K(v(k),(r,s)=>(m(),f("span",{key:r,class:u([t.$style.month,{[t.$style.current]:v(_)(s)}])},[c("span",null,S(r),1)],2))),128)),nt,ot,at,ut,c("span",{class:u(t.$style.sum)},S(v(B)("budget.totals")),3),(m(!0),f(w,null,K(G.value,(r,s)=>(m(),R(F,{key:s,value:r,class:u(t.$style.sum)},null,8,["value","class"]))),128)),rt,ct,(m(!0),f(w,null,K(N.value,r=>(m(),f(w,{key:r.id},[g(Z,{id:r.id,text:C,name:"budget-groups",onDrop:a},null,8,["id"]),g(et,{group:r},null,8,["group"])],64))),128)),dt,g(P,{class:u(t.$style.addGroupBtn),icon:"plus",text:v(B)("budget.addGroup"),onClick:$[0]||($[0]=r=>v(p)(t.type))},null,8,["class","text"])],2))}}),it="I_",mt="J_",gt="K_",vt="L_",yt="M_",ft={budgetGroups:it,sum:mt,month:gt,current:vt,addGroupBtn:yt},$t={$style:ft},bt=L(pt,[["__cssModules",$t]]),ht=T({__name:"BudgetPane",props:{title:{},type:{}},setup(b){const h=b,{state:l}=z(),d=M(()=>ce(l[h.type])),p=M(()=>d.value.reduce((i,_)=>i+_,0));return(i,_)=>(m(),R(de,{amount:p.value,title:i.title},{header:O(()=>[g(ie,{class:u(i.$style.miniChart),values:d.value},null,8,["class","values"])]),default:O(()=>[g(bt,{type:i.type},null,8,["type"])]),_:1},8,["amount","title"]))}}),_t="h_",Bt={miniChart:_t},Ct={$style:Bt},It=L(ht,[["__cssModules",Ct]]);export{It as B};
