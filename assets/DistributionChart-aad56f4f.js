import{d as $t,c as H,o as gt,i as ht,n as Pt,_ as Rt,f as Jt,e as Qt,B as w,a4 as te}from"./index-b8f8bbf8.js";import{C as ee}from"./ChartPlaceholder-38e9a432.js";import{e as x,c as st,d as Bt,f as ae,m as ne,g as Ht,k as Ft,h as re,j as St,l as F,n as vt,o as pt,p as ut,s as lt,q as X,r as ie,t as oe,v as ct,x as se,y as Xt,z as Et,A as K,B as wt,C as ue,D as le,E as ce,F as de,G as fe,S as Mt,H as xt,I as ge,J as he,P as ve,K as bt,L as kt,M as _t,N as pe,O as Tt,Q as At,R as Yt,T as ye,U as me,V as xe,W as Ie,X as Ct,Y as Le,Z as Ve,$ as De,a0 as Se,u as Ee,_ as we,b as Me}from"./EChart.vue_vue_type_script_setup_true_lang-c8e18314.js";import{t as U}from"./budgets-531db56b.js";import"./Icon-9ecb4fa7.js";import"./useResizeObserver-ea7ce5d0.js";var V=ne();function be(a){var t=a.mainData,e=a.datas;e||(e={main:t},a.datasAttr={main:"data"}),a.datas=a.mainData=null,jt(t,e,a),x(e,function(n){x(t.TRANSFERABLE_METHODS,function(r){n.wrapMethod(r,st(ke,a))})}),t.wrapMethod("cloneShallow",st(Te,a)),x(t.CHANGABLE_METHODS,function(n){t.wrapMethod(n,st(_e,a))}),Bt(e[t.dataType]===t)}function ke(a,t){if(Ge(this)){var e=ae({},V(this).datas);e[this.dataType]=t,jt(t,e,a)}else It(t,this.dataType,V(this).mainData,a);return t}function _e(a,t){return a.struct&&a.struct.update(),t}function Te(a,t){return x(V(t).datas,function(e,n){e!==t&&It(e.cloneShallow(),n,t,a)}),t}function Ae(a){var t=V(this).mainData;return a==null||t==null?t:V(t).datas[a]}function Ce(){var a=V(this).mainData;return a==null?[{data:a}]:Ht(Ft(V(a).datas),function(t){return{type:t,data:V(a).datas[t]}})}function Ge(a){return V(a).mainData===a}function jt(a,t,e){V(a).datas={},x(t,function(n,r){It(n,r,a,e)})}function It(a,t,e,n){V(e).datas[t]=a,V(a).mainData=e,a.dataType=t,n.struct&&(a[n.structAttr]=n.struct,n.struct[n.datasAttr[t]]=a),a.getLinkedData=Ae,a.getLinkedDataAll=Ce}var Y=x,ze=F,Z=-1,Lt=function(){function a(t){var e=t.mappingMethod,n=t.type,r=this.option=re(t);this.type=n,this.mappingMethod=e,this._normalizeData=Re[e];var i=a.visualHandlers[n];this.applyVisual=i.applyVisual,this.getColorMapper=i.getColorMapper,this._normalizedToVisual=i._normalizedToVisual[e],e==="piecewise"?(dt(r),$e(r)):e==="category"?r.categories?Pe(r):dt(r,!0):(Bt(e!=="linear"||r.dataExtent),dt(r))}return a.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},a.prototype.getNormalizer=function(){return St(this._normalizeData,this)},a.listVisualTypes=function(){return Ft(a.visualHandlers)},a.isValidType=function(t){return a.visualHandlers.hasOwnProperty(t)},a.eachVisual=function(t,e,n){F(t)?x(t,e,n):e.call(n,t)},a.mapVisual=function(t,e,n){var r,i=vt(t)?[]:F(t)?{}:(r=!0,null);return a.eachVisual(t,function(s,o){var u=e.call(n,s,o);r?i=u:i[o]=u}),i},a.retrieveVisuals=function(t){var e={},n;return t&&Y(a.visualHandlers,function(r,i){t.hasOwnProperty(i)&&(e[i]=t[i],n=!0)}),n?e:null},a.prepareVisualTypes=function(t){if(vt(t))t=t.slice();else if(ze(t)){var e=[];Y(t,function(n,r){e.push(r)}),t=e}else return[];return t.sort(function(n,r){return r==="color"&&n!=="color"&&n.indexOf("color")===0?1:-1}),t},a.dependsOn=function(t,e){return e==="color"?!!(t&&t.indexOf(e)===0):t===e},a.findPieceIndex=function(t,e,n){for(var r,i=1/0,s=0,o=e.length;s<o;s++){var u=e[s].value;if(u!=null){if(u===t||pt(u)&&u===t+"")return s;n&&p(u,s)}}for(var s=0,o=e.length;s<o;s++){var d=e[s],c=d.interval,g=d.close;if(c){if(c[0]===-1/0){if(q(g[1],t,c[1]))return s}else if(c[1]===1/0){if(q(g[0],c[0],t))return s}else if(q(g[0],c[0],t)&&q(g[1],t,c[1]))return s;n&&p(c[0],s),n&&p(c[1],s)}}if(n)return t===1/0?e.length-1:t===-1/0?0:r;function p(v,l){var f=Math.abs(v-t);f<i&&(i=f,r=l)}},a.visualHandlers={color:{applyVisual:R("color"),getColorMapper:function(){var t=this.option;return St(t.mappingMethod==="category"?function(e,n){return!n&&(e=this._normalizeData(e)),B.call(this,e)}:function(e,n,r){var i=!!r;return!n&&(e=this._normalizeData(e)),r=ut(e,t.parsedVisual,r),i?r:lt(r,"rgba")},this)},_normalizedToVisual:{linear:function(t){return lt(ut(t,this.option.parsedVisual),"rgba")},category:B,piecewise:function(t,e){var n=mt.call(this,e);return n==null&&(n=lt(ut(t,this.option.parsedVisual),"rgba")),n},fixed:k}},colorHue:W(function(t,e){return ct(t,e)}),colorSaturation:W(function(t,e){return ct(t,null,e)}),colorLightness:W(function(t,e){return ct(t,null,null,e)}),colorAlpha:W(function(t,e){return se(t,e)}),decal:{applyVisual:R("decal"),_normalizedToVisual:{linear:null,category:B,piecewise:null,fixed:null}},opacity:{applyVisual:R("opacity"),_normalizedToVisual:yt([0,1])},liftZ:{applyVisual:R("liftZ"),_normalizedToVisual:{linear:k,category:k,piecewise:k,fixed:k}},symbol:{applyVisual:function(t,e,n){var r=this.mapValueToVisual(t);n("symbol",r)},_normalizedToVisual:{linear:Gt,category:B,piecewise:function(t,e){var n=mt.call(this,e);return n==null&&(n=Gt.call(this,t)),n},fixed:k}},symbolSize:{applyVisual:R("symbolSize"),_normalizedToVisual:yt([0,1])}},a}();function $e(a){var t=a.pieceList;a.hasSpecialVisual=!1,x(t,function(e,n){e.originIndex=n,e.visual!=null&&(a.hasSpecialVisual=!0)})}function Pe(a){var t=a.categories,e=a.categoryMap={},n=a.visual;if(Y(t,function(s,o){e[s]=o}),!vt(n)){var r=[];F(n)?Y(n,function(s,o){var u=e[o];r[u??Z]=s}):r[Z]=n,n=Ot(a,r)}for(var i=t.length-1;i>=0;i--)n[i]==null&&(delete e[t[i]],t.pop())}function dt(a,t){var e=a.visual,n=[];F(e)?Y(e,function(i){n.push(i)}):e!=null&&n.push(e);var r={color:1,symbol:1};!t&&n.length===1&&!r.hasOwnProperty(a.type)&&(n[1]=n[0]),Ot(a,n)}function W(a){return{applyVisual:function(t,e,n){var r=this.mapValueToVisual(t);n("color",a(e("color"),r))},_normalizedToVisual:yt([0,1])}}function Gt(a){var t=this.option.visual;return t[Math.round(X(a,[0,1],[0,t.length-1],!0))]||{}}function R(a){return function(t,e,n){n(a,this.mapValueToVisual(t))}}function B(a){var t=this.option.visual;return t[this.option.loop&&a!==Z?a%t.length:a]}function k(){return this.option.visual[0]}function yt(a){return{linear:function(t){return X(t,a,this.option.visual,!0)},category:B,piecewise:function(t,e){var n=mt.call(this,e);return n==null&&(n=X(t,a,this.option.visual,!0)),n},fixed:k}}function mt(a){var t=this.option,e=t.pieceList;if(t.hasSpecialVisual){var n=Lt.findPieceIndex(a,e),r=e[n];if(r&&r.visual)return r.visual[this.type]}}function Ot(a,t){return a.visual=t,a.type==="color"&&(a.parsedVisual=Ht(t,function(e){var n=ie(e);return n||[0,0,0,1]})),t}var Re={linear:function(a){return X(a,this.option.dataExtent,[0,1],!0)},piecewise:function(a){var t=this.option.pieceList,e=Lt.findPieceIndex(a,t,!0);if(e!=null)return X(e,[0,t.length-1],[0,1],!0)},category:function(a){var t=this.option.categories?this.option.categoryMap[a]:a;return t??Z},fixed:oe};function q(a,t,e){return a?t<=e:t<e}const Be=Lt;function $(a){return"_EC_"+a}var He=function(){function a(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return a.prototype.isDirected=function(){return this._directed},a.prototype.addNode=function(t,e){t=t==null?""+e:""+t;var n=this._nodesMap;if(!n[$(t)]){var r=new _(t,e);return r.hostGraph=this,this.nodes.push(r),n[$(t)]=r,r}},a.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},a.prototype.getNodeById=function(t){return this._nodesMap[$(t)]},a.prototype.addEdge=function(t,e,n){var r=this._nodesMap,i=this._edgesMap;if(Et(t)&&(t=this.nodes[t]),Et(e)&&(e=this.nodes[e]),t instanceof _||(t=r[$(t)]),e instanceof _||(e=r[$(e)]),!(!t||!e)){var s=t.id+"-"+e.id,o=new Nt(t,e,n);return o.hostGraph=this,this._directed&&(t.outEdges.push(o),e.inEdges.push(o)),t.edges.push(o),t!==e&&e.edges.push(o),this.edges.push(o),i[s]=o,o}},a.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},a.prototype.getEdge=function(t,e){t instanceof _&&(t=t.id),e instanceof _&&(e=e.id);var n=this._edgesMap;return this._directed?n[t+"-"+e]:n[t+"-"+e]||n[e+"-"+t]},a.prototype.eachNode=function(t,e){for(var n=this.nodes,r=n.length,i=0;i<r;i++)n[i].dataIndex>=0&&t.call(e,n[i],i)},a.prototype.eachEdge=function(t,e){for(var n=this.edges,r=n.length,i=0;i<r;i++)n[i].dataIndex>=0&&n[i].node1.dataIndex>=0&&n[i].node2.dataIndex>=0&&t.call(e,n[i],i)},a.prototype.breadthFirstTraverse=function(t,e,n,r){if(e instanceof _||(e=this._nodesMap[$(e)]),!!e){for(var i=n==="out"?"outEdges":n==="in"?"inEdges":"edges",s=0;s<this.nodes.length;s++)this.nodes[s].__visited=!1;if(!t.call(r,e,null))for(var o=[e];o.length;)for(var u=o.shift(),d=u[i],s=0;s<d.length;s++){var c=d[s],g=c.node1===u?c.node2:c.node1;if(!g.__visited){if(t.call(r,g,u))return;o.push(g),g.__visited=!0}}}},a.prototype.update=function(){for(var t=this.data,e=this.edgeData,n=this.nodes,r=this.edges,i=0,s=n.length;i<s;i++)n[i].dataIndex=-1;for(var i=0,s=t.count();i<s;i++)n[t.getRawIndex(i)].dataIndex=i;e.filterSelf(function(o){var u=r[e.getRawIndex(o)];return u.node1.dataIndex>=0&&u.node2.dataIndex>=0});for(var i=0,s=r.length;i<s;i++)r[i].dataIndex=-1;for(var i=0,s=e.count();i<s;i++)r[e.getRawIndex(i)].dataIndex=i},a.prototype.clone=function(){for(var t=new a(this._directed),e=this.nodes,n=this.edges,r=0;r<e.length;r++)t.addNode(e[r].id,e[r].dataIndex);for(var r=0;r<n.length;r++){var i=n[r];t.addEdge(i.node1.id,i.node2.id,i.dataIndex)}return t},a}(),_=function(){function a(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=t??"",this.dataIndex=e??-1}return a.prototype.degree=function(){return this.edges.length},a.prototype.inDegree=function(){return this.inEdges.length},a.prototype.outDegree=function(){return this.outEdges.length},a.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,n=e.data.getItemModel(this.dataIndex);return n.getModel(t)}},a.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var n=this.edges[e];n.dataIndex<0||(t.edge.push(n.dataIndex),t.node.push(n.node1.dataIndex,n.node2.dataIndex))}return t},a.prototype.getTrajectoryDataIndices=function(){for(var t=K(),e=K(),n=0;n<this.edges.length;n++){var r=this.edges[n];if(!(r.dataIndex<0)){t.set(r.dataIndex,!0);for(var i=[r.node1],s=[r.node2],o=0;o<i.length;){var u=i[o];o++,e.set(u.dataIndex,!0);for(var d=0;d<u.inEdges.length;d++)t.set(u.inEdges[d].dataIndex,!0),i.push(u.inEdges[d].node1)}for(o=0;o<s.length;){var c=s[o];o++,e.set(c.dataIndex,!0);for(var d=0;d<c.outEdges.length;d++)t.set(c.outEdges[d].dataIndex,!0),s.push(c.outEdges[d].node2)}}}return{edge:t.keys(),node:e.keys()}},a}(),Nt=function(){function a(t,e,n){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=n??-1}return a.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,n=e.edgeData.getItemModel(this.dataIndex);return n.getModel(t)}},a.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},a.prototype.getTrajectoryDataIndices=function(){var t=K(),e=K();t.set(this.dataIndex,!0);for(var n=[this.node1],r=[this.node2],i=0;i<n.length;){var s=n[i];i++,e.set(s.dataIndex,!0);for(var o=0;o<s.inEdges.length;o++)t.set(s.inEdges[o].dataIndex,!0),n.push(s.inEdges[o].node1)}for(i=0;i<r.length;){var u=r[i];i++,e.set(u.dataIndex,!0);for(var o=0;o<u.outEdges.length;o++)t.set(u.outEdges[o].dataIndex,!0),r.push(u.outEdges[o].node2)}return{edge:t.keys(),node:e.keys()}},a}();function Ut(a,t){return{getValue:function(e){var n=this[a][t];return n.getStore().get(n.getDimensionIndex(e||"value"),this.dataIndex)},setVisual:function(e,n){this.dataIndex>=0&&this[a][t].setItemVisual(this.dataIndex,e,n)},getVisual:function(e){return this[a][t].getItemVisual(this.dataIndex,e)},setLayout:function(e,n){this.dataIndex>=0&&this[a][t].setItemLayout(this.dataIndex,e,n)},getLayout:function(){return this[a][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[a][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[a][t].getRawIndex(this.dataIndex)}}}Xt(_,Ut("hostGraph","data"));Xt(Nt,Ut("hostGraph","edgeData"));const Fe=He;function Xe(a,t,e,n,r){for(var i=new Fe(n),s=0;s<a.length;s++)i.addNode(wt(a[s].id,a[s].name,s),s);for(var o=[],u=[],d=0,s=0;s<t.length;s++){var c=t[s],g=c.source,p=c.target;i.addEdge(g,p,d)&&(u.push(c),o.push(wt(ue(c.id,null),g+" > "+p)),d++)}var v=e.get("coordinateSystem"),l;if(v==="cartesian2d"||v==="polar")l=le(a,e);else{var f=ce.get(v),h=f?f.dimensions||[]:[];de(h,"value")<0&&h.concat(["value"]);var y=fe(a,{coordDimensions:h,encodeDefine:e.getEncode()}).dimensions;l=new Mt(y,e),l.initData(a)}var m=new Mt(["value"],e);return m.initData(u,o),r&&r(l,m),be({mainData:l,struct:i,structAttr:"graph",datas:{node:l,edge:m},datasAttr:{node:"data",edge:"edgeData"}}),i.update(),i}var Ye=function(){function a(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return a}(),je=function(a){xt(t,a);function t(e){return a.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new Ye},t.prototype.buildPath=function(e,n){var r=n.extent;e.moveTo(n.x1,n.y1),e.bezierCurveTo(n.cpx1,n.cpy1,n.cpx2,n.cpy2,n.x2,n.y2),n.orient==="vertical"?(e.lineTo(n.x2+r,n.y2),e.bezierCurveTo(n.cpx2+r,n.cpy2,n.cpx1+r,n.cpy1,n.x1+r,n.y1)):(e.lineTo(n.x2,n.y2+r),e.bezierCurveTo(n.cpx2,n.cpy2+r,n.cpx1,n.cpy1+r,n.x1,n.y1+r)),e.closePath()},t.prototype.highlight=function(){ge(this)},t.prototype.downplay=function(){he(this)},t}(ve),Oe=function(a){xt(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;return e.type=t.type,e._focusAdjacencyDisabled=!1,e}return t.prototype.render=function(e,n,r){var i=this,s=e.getGraph(),o=this.group,u=e.layoutInfo,d=u.width,c=u.height,g=e.getData(),p=e.getData("edge"),v=e.get("orient");this._model=e,o.removeAll(),o.x=u.x,o.y=u.y,s.eachEdge(function(l){var f=new je,h=bt(f);h.dataIndex=l.dataIndex,h.seriesIndex=e.seriesIndex,h.dataType="edge";var y=l.getModel(),m=y.getModel("lineStyle"),I=m.get("curveness"),L=l.node1.getLayout(),D=l.node1.getModel(),E=D.get("localX"),S=D.get("localY"),T=l.node2.getLayout(),Vt=l.node2.getModel(),j=Vt.get("localX"),O=Vt.get("localY"),P=l.getLayout(),A,C,G,z,Q,tt,et,at;f.shape.extent=Math.max(1,P.dy),f.shape.orient=v,v==="vertical"?(A=(E!=null?E*d:L.x)+P.sy,C=(S!=null?S*c:L.y)+L.dy,G=(j!=null?j*d:T.x)+P.ty,z=O!=null?O*c:T.y,Q=A,tt=C*(1-I)+z*I,et=G,at=C*I+z*(1-I)):(A=(E!=null?E*d:L.x)+L.dx,C=(S!=null?S*c:L.y)+P.sy,G=j!=null?j*d:T.x,z=(O!=null?O*c:T.y)+P.ty,Q=A*(1-I)+G*I,tt=C,et=A*I+G*(1-I),at=z),f.setShape({x1:A,y1:C,x2:G,y2:z,cpx1:Q,cpy1:tt,cpx2:et,cpy2:at}),f.useStyle(m.getItemStyle()),zt(f.style,v,l);var Dt=""+y.get("value"),nt=kt(y,"edgeLabel");_t(f,nt,{labelFetcher:{getFormattedLabel:function(ot,N,Ea,qt,Kt,Zt){return e.getFormattedLabel(ot,N,"edge",qt,pe(Kt,nt.normal&&nt.normal.get("formatter"),Dt),Zt)}},labelDataIndex:l.dataIndex,defaultText:Dt}),f.setTextConfig({position:"inside"});var rt=y.getModel("emphasis");Tt(f,y,"lineStyle",function(ot){var N=ot.getItemStyle();return zt(N,v,l),N}),o.add(f),p.setItemGraphicEl(l.dataIndex,f);var it=rt.get("focus");At(f,it==="adjacency"?l.getAdjacentDataIndices():it==="trajectory"?l.getTrajectoryDataIndices():it,rt.get("blurScope"),rt.get("disabled"))}),s.eachNode(function(l){var f=l.getLayout(),h=l.getModel(),y=h.get("localX"),m=h.get("localY"),I=h.getModel("emphasis"),L=new Yt({shape:{x:y!=null?y*d:f.x,y:m!=null?m*c:f.y,width:f.dx,height:f.dy},style:h.getModel("itemStyle").getItemStyle(),z2:10});_t(L,kt(h),{labelFetcher:{getFormattedLabel:function(E,S){return e.getFormattedLabel(E,S,"node")}},labelDataIndex:l.dataIndex,defaultText:l.id}),L.disableLabelAnimation=!0,L.setStyle("fill",l.getVisual("color")),L.setStyle("decal",l.getVisual("style").decal),Tt(L,h),o.add(L),g.setItemGraphicEl(l.dataIndex,L),bt(L).dataType="node";var D=I.get("focus");At(L,D==="adjacency"?l.getAdjacentDataIndices():D==="trajectory"?l.getTrajectoryDataIndices():D,I.get("blurScope"),I.get("disabled"))}),g.eachItemGraphicEl(function(l,f){var h=g.getItemModel(f);h.get("draggable")&&(l.drift=function(y,m){i._focusAdjacencyDisabled=!0,this.shape.x+=y,this.shape.y+=m,this.dirty(),r.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:g.getRawIndex(f),localX:this.shape.x/d,localY:this.shape.y/c})},l.ondragend=function(){i._focusAdjacencyDisabled=!1},l.draggable=!0,l.cursor="move")}),!this._data&&e.isAnimationEnabled()&&o.setClipPath(Ne(o.getBoundingRect(),e,function(){o.removeClipPath()})),this._data=e.getData()},t.prototype.dispose=function(){},t.type="sankey",t}(ye);function zt(a,t,e){switch(a.fill){case"source":a.fill=e.node1.getVisual("color"),a.decal=e.node1.getVisual("style").decal;break;case"target":a.fill=e.node2.getVisual("color"),a.decal=e.node2.getVisual("style").decal;break;case"gradient":var n=e.node1.getVisual("color"),r=e.node2.getVisual("color");pt(n)&&pt(r)&&(a.fill=new me(0,0,+(t==="horizontal"),+(t==="vertical"),[{color:n,offset:0},{color:r,offset:1}]))}}function Ne(a,t,e){var n=new Yt({shape:{x:a.x-10,y:a.y-10,width:0,height:a.height+20}});return xe(n,{shape:{width:a.width+20}},t,e),n}const Ue=Oe;var We=function(a){xt(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,n){var r=e.edges||e.links,i=e.data||e.nodes,s=e.levels;this.levelModels=[];for(var o=this.levelModels,u=0;u<s.length;u++)s[u].depth!=null&&s[u].depth>=0&&(o[s[u].depth]=new Ie(s[u],this,n));if(i&&r){var d=Xe(i,r,this,!0,c);return d.data}function c(g,p){g.wrapMethod("getItemModel",function(v,l){var f=v.parentModel,h=f.getData().getItemLayout(l);if(h){var y=h.depth,m=f.levelModels[y];m&&(v.parentModel=m)}return v}),p.wrapMethod("getItemModel",function(v,l){var f=v.parentModel,h=f.getGraph().getEdgeByIndex(l),y=h.node1.getLayout();if(y){var m=y.depth,I=f.levelModels[m];I&&(v.parentModel=I)}return v})}},t.prototype.setNodePosition=function(e,n){var r=this.option.data||this.option.nodes,i=r[e];i.localX=n[0],i.localY=n[1]},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,n,r){function i(v){return isNaN(v)||v==null}if(r==="edge"){var s=this.getDataParams(e,r),o=s.data,u=s.value,d=o.source+" -- "+o.target;return Ct("nameValue",{name:d,value:u,noValue:i(u)})}else{var c=this.getGraph().getNodeByIndex(e),g=c.getLayout().value,p=this.getDataParams(e,r).data.name;return Ct("nameValue",{name:p!=null?p+"":null,value:g,noValue:i(g)})}},t.prototype.optionUpdated=function(){},t.prototype.getDataParams=function(e,n){var r=a.prototype.getDataParams.call(this,e,n);if(r.value==null&&n==="node"){var i=this.getGraph().getNodeByIndex(e),s=i.getLayout().value;r.value=s}return r},t.type="series.sankey",t.defaultOption={z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3},t}(Le);const qe=We;function Ke(a,t){a.eachSeriesByType("sankey",function(e){var n=e.get("nodeWidth"),r=e.get("nodeGap"),i=Ze(e,t);e.layoutInfo=i;var s=i.width,o=i.height,u=e.getGraph(),d=u.nodes,c=u.edges;Qe(d);var g=Ve(d,function(f){return f.getLayout().value===0}),p=g.length!==0?0:e.get("layoutIterations"),v=e.get("orient"),l=e.get("nodeAlign");Je(d,c,n,r,s,o,p,v,l)})}function Ze(a,t){return De(a.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function Je(a,t,e,n,r,i,s,o,u){ta(a,t,e,r,i,o,u),ra(a,t,i,r,n,s,o),ga(a,o)}function Qe(a){x(a,function(t){var e=M(t.outEdges,J),n=M(t.inEdges,J),r=t.getValue()||0,i=Math.max(e,n,r);t.setLayout({value:i},!0)})}function ta(a,t,e,n,r,i,s){for(var o=[],u=[],d=[],c=[],g=0,p=0;p<t.length;p++)o[p]=1;for(var p=0;p<a.length;p++)u[p]=a[p].inEdges.length,u[p]===0&&d.push(a[p]);for(var v=-1;d.length;){for(var l=0;l<d.length;l++){var f=d[l],h=f.hostGraph.data.getRawDataItem(f.dataIndex),y=h.depth!=null&&h.depth>=0;y&&h.depth>v&&(v=h.depth),f.setLayout({depth:y?h.depth:g},!0),i==="vertical"?f.setLayout({dy:e},!0):f.setLayout({dx:e},!0);for(var m=0;m<f.outEdges.length;m++){var I=f.outEdges[m],L=t.indexOf(I);o[L]=0;var D=I.node2,E=a.indexOf(D);--u[E]===0&&c.indexOf(D)<0&&c.push(D)}}++g,d=c,c=[]}for(var p=0;p<o.length;p++)if(o[p]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var S=v>g-1?v:g-1;s&&s!=="left"&&ea(a,s,i,S);var T=i==="vertical"?(r-e)/S:(n-e)/S;na(a,T,i)}function Wt(a){var t=a.hostGraph.data.getRawDataItem(a.dataIndex);return t.depth!=null&&t.depth>=0}function ea(a,t,e,n){if(t==="right"){for(var r=[],i=a,s=0;i.length;){for(var o=0;o<i.length;o++){var u=i[o];u.setLayout({skNodeHeight:s},!0);for(var d=0;d<u.inEdges.length;d++){var c=u.inEdges[d];r.indexOf(c.node1)<0&&r.push(c.node1)}}i=r,r=[],++s}x(a,function(g){Wt(g)||g.setLayout({depth:Math.max(0,n-g.getLayout().skNodeHeight)},!0)})}else t==="justify"&&aa(a,n)}function aa(a,t){x(a,function(e){!Wt(e)&&!e.outEdges.length&&e.setLayout({depth:t},!0)})}function na(a,t,e){x(a,function(n){var r=n.getLayout().depth*t;e==="vertical"?n.setLayout({y:r},!0):n.setLayout({x:r},!0)})}function ra(a,t,e,n,r,i,s){var o=ia(a,s);oa(o,t,e,n,r,s),ft(o,r,e,n,s);for(var u=1;i>0;i--)u*=.99,sa(o,u,s),ft(o,r,e,n,s),fa(o,u,s),ft(o,r,e,n,s)}function ia(a,t){var e=[],n=t==="vertical"?"y":"x",r=Se(a,function(i){return i.getLayout()[n]});return r.keys.sort(function(i,s){return i-s}),x(r.keys,function(i){e.push(r.buckets.get(i))}),e}function oa(a,t,e,n,r,i){var s=1/0;x(a,function(o){var u=o.length,d=0;x(o,function(g){d+=g.getLayout().value});var c=i==="vertical"?(n-(u-1)*r)/d:(e-(u-1)*r)/d;c<s&&(s=c)}),x(a,function(o){x(o,function(u,d){var c=u.getLayout().value*s;i==="vertical"?(u.setLayout({x:d},!0),u.setLayout({dx:c},!0)):(u.setLayout({y:d},!0),u.setLayout({dy:c},!0))})}),x(t,function(o){var u=+o.getValue()*s;o.setLayout({dy:u},!0)})}function ft(a,t,e,n,r){var i=r==="vertical"?"x":"y";x(a,function(s){s.sort(function(f,h){return f.getLayout()[i]-h.getLayout()[i]});for(var o,u,d,c=0,g=s.length,p=r==="vertical"?"dx":"dy",v=0;v<g;v++)u=s[v],d=c-u.getLayout()[i],d>0&&(o=u.getLayout()[i]+d,r==="vertical"?u.setLayout({x:o},!0):u.setLayout({y:o},!0)),c=u.getLayout()[i]+u.getLayout()[p]+t;var l=r==="vertical"?n:e;if(d=c-t-l,d>0){o=u.getLayout()[i]-d,r==="vertical"?u.setLayout({x:o},!0):u.setLayout({y:o},!0),c=o;for(var v=g-2;v>=0;--v)u=s[v],d=u.getLayout()[i]+u.getLayout()[p]+t-c,d>0&&(o=u.getLayout()[i]-d,r==="vertical"?u.setLayout({x:o},!0):u.setLayout({y:o},!0)),c=u.getLayout()[i]}})}function sa(a,t,e){x(a.slice().reverse(),function(n){x(n,function(r){if(r.outEdges.length){var i=M(r.outEdges,ua,e)/M(r.outEdges,J);if(isNaN(i)){var s=r.outEdges.length;i=s?M(r.outEdges,la,e)/s:0}if(e==="vertical"){var o=r.getLayout().x+(i-b(r,e))*t;r.setLayout({x:o},!0)}else{var u=r.getLayout().y+(i-b(r,e))*t;r.setLayout({y:u},!0)}}})})}function ua(a,t){return b(a.node2,t)*a.getValue()}function la(a,t){return b(a.node2,t)}function ca(a,t){return b(a.node1,t)*a.getValue()}function da(a,t){return b(a.node1,t)}function b(a,t){return t==="vertical"?a.getLayout().x+a.getLayout().dx/2:a.getLayout().y+a.getLayout().dy/2}function J(a){return a.getValue()}function M(a,t,e){for(var n=0,r=a.length,i=-1;++i<r;){var s=+t(a[i],e);isNaN(s)||(n+=s)}return n}function fa(a,t,e){x(a,function(n){x(n,function(r){if(r.inEdges.length){var i=M(r.inEdges,ca,e)/M(r.inEdges,J);if(isNaN(i)){var s=r.inEdges.length;i=s?M(r.inEdges,da,e)/s:0}if(e==="vertical"){var o=r.getLayout().x+(i-b(r,e))*t;r.setLayout({x:o},!0)}else{var u=r.getLayout().y+(i-b(r,e))*t;r.setLayout({y:u},!0)}}})})}function ga(a,t){var e=t==="vertical"?"x":"y";x(a,function(n){n.outEdges.sort(function(r,i){return r.node2.getLayout()[e]-i.node2.getLayout()[e]}),n.inEdges.sort(function(r,i){return r.node1.getLayout()[e]-i.node1.getLayout()[e]})}),x(a,function(n){var r=0,i=0;x(n.outEdges,function(s){s.setLayout({sy:r},!0),r+=s.getLayout().dy}),x(n.inEdges,function(s){s.setLayout({ty:i},!0),i+=s.getLayout().dy})})}function ha(a){a.eachSeriesByType("sankey",function(t){var e=t.getGraph(),n=e.nodes,r=e.edges;if(n.length){var i=1/0,s=-1/0;x(n,function(o){var u=o.getLayout().value;u<i&&(i=u),u>s&&(s=u)}),x(n,function(o){var u=new Be({type:"color",mappingMethod:"linear",dataExtent:[i,s],visual:t.get("color")}),d=u.mapValueToVisual(o.getLayout().value),c=o.getModel().get(["itemStyle","color"]);c!=null?(o.setVisual("color",c),o.setVisual("style",{fill:c})):(o.setVisual("color",d),o.setVisual("style",{fill:d}))})}r.length&&x(r,function(o){var u=o.getModel().get("lineStyle");o.setVisual("style",u)})})}function va(a){a.registerChartView(Ue),a.registerSeriesModel(qe),a.registerLayout(Ke),a.registerVisual(ha),a.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(n){n.setNodePosition(t.dataIndex,[t.localX,t.localY])})})}const pa=$t({__name:"SankeyChart",props:{class:{},data:{}},setup(a){const t=a;Ee([va,Me]);const e=H(()=>t.class),n=H(()=>({animation:!1,series:{type:"sankey",label:{formatter:"{b}",textBorderWidth:0,fontWeight:"var(--font-weight-l)",fontFamily:"var(--font-family)",color:"var(--chart-label)"},lineStyle:{color:"source",curveness:.5},nodeGap:10,nodeWidth:7,left:0,right:0,links:t.data.links,data:t.data.labels.map(r=>({name:r.name,id:r.id,itemStyle:{color:r.color},label:r.align==="left"?{align:"right",padding:[0,20,0,0]}:void 0})),silent:!0}}));return(r,i)=>(gt(),ht(we,{class:Pt([r.$style.sankeyChart,e.value]),options:n.value},null,8,["class","options"]))}}),ya="J_",ma={sankeyChart:ya},xa={$style:ma},Ia=Rt(pa,[["__cssModules",xa]]),La=$t({__name:"DistributionChart",props:{class:{}},setup(a){const t=a,e=H(()=>t.class),{state:n}=Jt(),{n:r}=Qt(),i=H(()=>{const o=w(U(n.income)),u=w(U(n.expenses));return!o||!u}),s=H(()=>{const o=l=>r(l,"currency"),u=w(U(n.income)),d=w(U(n.expenses)),c=[],g=[],p=l=>`hsl(${l}, var(--chart-generic-saturation), var(--chart-generic-lightness))`,v={id:te(),name:`Income (${o(u)})`,color:p(120)};c.push(v);for(const l of n.income){const f=w(l.budgets.flatMap(h=>h.values));c.push({id:l.id,name:`${l.name} (${o(f)})`,color:p(60+60*(f/u))}),g.push({target:v.id,source:l.id,value:f});for(let h=0;h<l.budgets.length;h++){const y=l.budgets[h],m=w(y.values);m&&(c.push({id:y.id,name:`${y.name} (${o(m)})`,color:p(60+60*(m/u))}),g.push({target:l.id,source:y.id,value:m}))}}for(const l of n.expenses){const f=w(l.budgets.flatMap(h=>h.values));c.push({id:l.id,name:`${l.name} (${o(f)})`,color:p(60*(1-f/d))}),g.push({target:l.id,source:v.id,value:f});for(let h=0;h<l.budgets.length;h++){const y=l.budgets[h],m=w(y.values);m&&(c.push({id:y.id,name:`${y.name} (${o(m)})`,color:p(60*(1-m/d)),align:"left"}),g.push({target:y.id,source:l.id,value:m}))}}return{labels:c,links:g}});return(o,u)=>i.value?(gt(),ht(ee,{key:0})):(gt(),ht(Ia,{key:1,class:Pt([o.$style.distributionChart,e.value]),data:s.value},null,8,["class","data"]))}}),Va="s",Da={distributionChart:Va},Sa={$style:Da},Ca=Rt(La,[["__cssModules",Sa]]);export{Ca as default};
